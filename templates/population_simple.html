{% extends 'layout.html' %}

{% block styles %}
{{super()}}
<link rel="stylesheet" href="/static/css/barchart.css" />
<link rel="stylesheet" href="/static/css/highlight.css" />
{% endblock %}

{% block scripts %}
{{super()}}
<script type="text/javascript" src="/static/js/jquery.address-1.4.min.js"></script>
<script type="text/javascript" src="/static/js/d3/d3.min.js"></script>
<script type="text/javascript" src="/static/js/d3/d3.layout.min.js"></script>
<script type="text/javascript" src="/static/js/d3/d3.csv.min.js"></script>
<script type="text/javascript" src="/static/js/barchart.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$.address.parameter("type","ethnicity");
	
	$("form .only").hide();
	
	$("form.controls .filter input").click(function(event){
		$.address.parameter("filter",this.value);
	});
	$("#percent").click(function(){
		if(this.checked){
			$.address.parameter("percent",this.value);
		}else{
			$.address.parameter("percent","");
		}
	});
	$("#scale").click(function(){
		if(this.checked){
			$.address.parameter("scale",this.value);
		}else{
			$.address.parameter("scale","");
		}
	});
	
	$("#no-census").click(function(){
		if(this.checked){
			$.address.parameter("no-census",this.value);
		}else{
			$.address.parameter("no-census","");
		}
	});
	
	$.address.change(function(event){
		if($.address.parameter("percent") && $.address.parameter("percent")!=""){
			$("#percent").attr("checked",true);
			$(".percent.only").show();
			$(".no-percent.only").hide();
		}else{
			$("#percent").attr("checked",false);
			$(".percent.only").hide();
			$(".no-percent.only").show();
		}
		if($.address.parameter("scale") && $.address.parameter("scale")!=""){
			$("#scale").attr("checked",true);
		}else{
			$("#scale").attr("checked",false);
		}
		
		if($.address.parameter("no-census") && $.address.parameter("no-census")!=""){
			$("#no-census").attr("checked",true);
		}else{
			$("#no-census").attr("checked",false);
		}
		
		if($.address.parameter("filter") && $.address.parameter("filter")!=""){
			$("input[value='"+unescape($.address.parameter("filter"))+"']").attr("checked",true)
		}
		
	});
});

function return_number(d){
	if(!$.address.parameter("percent") || $.address.parameter("percent")==""){
		$(".chart").removeClass("percent");
		if($.address.parameter("no-census") && d['Category']=='Census'){
			return 0;
		}
		return Number(d[unescape($.address.parameter("filter"))]);
	}
	$(".chart").addClass("percent");
	return Math.round(d[unescape($.address.parameter("filter"))]/d['Total']*100);
}

</script>
{% endblock %}

{% block header %}
<h1>San Francisco Ethnic Demographics by HIV Status in 2010</h1>
{% endblock %}

{% block content %}
<form class="controls">
	<fieldset class="filter">
		<legend>Pick an ethnicity to view</legend>
		<label class="radio"><input name="filter" type="radio" value="White" />White</label>
		<label class="radio"><input name="filter" type="radio" value="African American" />African American</label>
		<label class="radio"><input name="filter" type="radio" value="Latino" />Hispanic/Latino</label>
		<label class="radio"><input name="filter" type="radio" value="Asian/Pacific Islander" />Asian/Pacific Islander</label>
	</fieldset>
	<fieldset class="percent">
		<legend>Adjust chart</legend>
		<label><input id="percent" type="checkbox" />View metrics as percent of total population.</label>
		<label class="percent only"><input id="scale" type="checkbox" />Zoom in</label>
		<label class="no-percent only"><input id="no-census" type="checkbox" />Hide total San Francisco Population metric.</label>
	</fieldset>
</form>
<div class="chart barchart percent horizontal" data-duration="1500" data-ticks="6" data-rotate="true" data-csv="/static/data/2010PopPercentages.csv"></div>
{% endblock %}

{% block templates %}
<div class="highlight"></div>
{% endblock %}